{{ define "body" }}
    <body class="disable-hor-scroll" style="background: transparent;">
{{ end }}

{{ define "main" }}
    <div class="video-container" style="opacity: 0;">
        <video id="bg-video" autoplay muted loop playsinline preload="auto">
            <source src="{{ "videos/background.mp4" | relURL }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <div class="content">
        <div class="homepage-bg">
            <h1>{{ .Site.Title }}</h1>

            {{ partial "subtitle.html" . }}

            <div class="homepage-buttons">
                <p>
                    <span><a href="{{ "resume" | absLangURL }}"><button>About me</button></a></span> 
                    <span><a href="{{ "projects" | absLangURL }}"><button>My projects</button></a></span>
                </p>
            </div>
        </div>
    </div>

    <script>
        (function() {
            function isMobileDisplay() {
                const mQuery = getComputedStyle(document.body).getPropertyValue("--phoneWidth");
                return window.matchMedia(mQuery).matches;
            }

            if (!isMobileDisplay()) {
                document.body.style.background = "transparent";
            }
            
            const videoContainer = document.querySelector(".video-container");
            const video = document.getElementById("bg-video");
            
            if (!video || !videoContainer) {
                console.error("Video elements not found");
                return;
            }

            let playAttempted = false;

            function attemptPlay() {
                if (playAttempted) return;
                playAttempted = true;

                console.log("Attempting to play video, readyState:", video.readyState);
                
                video.play()
                    .then(() => {
                        console.log("Video playing successfully");
                        videoContainer.style.opacity = "1";
                    })
                    .catch(error => {
                        console.error("Video play failed:", error);
                        videoContainer.style.opacity = "1"; // Show anyway
                    });
            }

            // Error handling
            video.addEventListener("error", function(e) {
                console.error("Video error:", e, "Network state:", video.networkState);
            });

            // Success handling
            video.addEventListener("loadeddata", function() {
                console.log("Video data loaded");
                attemptPlay();
            });

            video.addEventListener("canplay", function() {
                console.log("Video can play");
                attemptPlay();
            });

            // Immediate attempt if already loaded
            if (video.readyState >= 2) {
                console.log("Video already ready");
                attemptPlay();
            }

            // Fallback: Try on user interaction
            function userInteractionPlay() {
                console.log("User interaction detected");
                attemptPlay();
            }

            document.addEventListener("click", userInteractionPlay, { once: true });
            document.addEventListener("touchstart", userInteractionPlay, { once: true });

            // Last resort: Try after delay
            setTimeout(() => {
                if (!playAttempted) {
                    console.log("Timeout fallback");
                    attemptPlay();
                }
            }, 1000);
        })();
    </script>
{{ end }}
