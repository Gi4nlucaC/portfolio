{{ define "body" }}
    <body class="disable-hor-scroll" style="background: transparent;">
{{ end }}

{{ define "main" }}
    <div class="video-container">
        <video id="bg-video" autoplay muted loop playsinline preload="auto">
            <source src="{{ "videos/background_new.mp4" | relURL }}" type="video/mp4">
        </video>
        <button id="bg-video-play-fallback" class="bg-video-play-fallback" style="display:none;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:10;padding:12px 18px;border-radius:6px;border:none;background:rgba(0,0,0,0.6);color:#fff;">Play</button>
    </div>

    <div class="content">
        <div class="homepage-bg">
            <h1>{{ .Site.Title }}</h1>

            {{ partial "subtitle.html" . }}

            <div class="homepage-buttons">
                <p>
                    <span><a href="{{ "resume" | absLangURL }}"><button>About me</button></a></span> 
                    <span><a href="{{ "projects" | absLangURL }}"><button>My projects</button></a></span>
                </p>
            </div>
        </div>
    </div>

    <script>
        (function() {
            function isMobileDisplay() {
                const mQuery = getComputedStyle(document.body).getPropertyValue("--phoneWidth");
                return window.matchMedia(mQuery).matches;
            }

            if (!isMobileDisplay()) {
                document.body.style.background = "transparent";
            }

            document.addEventListener("DOMContentLoaded", function () {
                const videoContainer = document.querySelector(".video-container");
                const video = document.getElementById("bg-video");

                function playVideo() {
                    videoContainer.style.opacity = "1";
                    video.play().then(() => {
                        var fb = document.getElementById('bg-video-play-fallback'); if (fb) fb.style.display = 'none';
                    }).catch(error => {
                        // Autoplay blocked: show fallback play button for user interaction
                        console.log("Autoplay prevented:", error);
                        var fb = document.getElementById('bg-video-play-fallback');
                        if (fb) fb.style.display = 'block';
                    });
                }

                // Ensure browser starts loading the video
                try { video.load(); } catch(e) {}

                if (video.readyState >= 3) {
                    playVideo();
                } else {
                    video.addEventListener('loadeddata', playVideo);
                    video.addEventListener('canplaythrough', playVideo);
                }

                // click anywhere to try and play
                video.addEventListener("click", function(){ playVideo(); });
                var fallbackBtn = document.getElementById('bg-video-play-fallback');
                if (fallbackBtn) {
                    fallbackBtn.addEventListener('click', function(e){
                        e.stopPropagation();
                        // user interaction should allow playback
                        video.muted = false;
                        playVideo();
                    });
                }
            });
        })();
    </script>
{{ end }}
