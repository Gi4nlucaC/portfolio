{{ define "body" }}
    <body class="disable-hor-scroll" style="background: transparent;">
{{ end }}

{{ define "main" }}
    <div class="video-container" style="opacity: 0; background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);">
        <video id="bg-video" autoplay muted loop playsinline preload="none" poster="">
            <source src="{{ "videos/background.mp4" | relURL }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <div class="content">
        <div class="homepage-bg">
            <h1>{{ .Site.Title }}</h1>

            {{ partial "subtitle.html" . }}

            <div class="homepage-buttons">
                <p>
                    <span><a href="{{ "resume" | absLangURL }}"><button>About me</button></a></span> 
                    <span><a href="{{ "projects" | absLangURL }}"><button>My projects</button></a></span>
                </p>
            </div>
        </div>
    </div>

    <script>
        (function() {
            function isMobileDisplay() {
                const mQuery = getComputedStyle(document.body).getPropertyValue("--phoneWidth");
                return window.matchMedia(mQuery).matches;
            }

            if (!isMobileDisplay()) {
                document.body.style.background = "transparent";
            }
            
            const videoContainer = document.querySelector(".video-container");
            const video = document.getElementById("bg-video");
            
            if (!video || !videoContainer) {
                console.error("Video elements not found");
                return;
            }

            // Always show the container (with gradient fallback)
            videoContainer.style.opacity = "1";

            let playAttempted = false;
            let videoLoaded = false;

            function attemptPlay() {
                if (playAttempted) return;
                playAttempted = true;

                console.log("Attempting to play video, readyState:", video.readyState, "networkState:", video.networkState);
                
                video.play()
                    .then(() => {
                        console.log("Video playing successfully");
                        videoLoaded = true;
                    })
                    .catch(error => {
                        console.warn("Video play failed, using gradient fallback:", error);
                    });
            }

            // Error handling - graceful degradation
            video.addEventListener("error", function(e) {
                console.warn("Video error, using gradient fallback. Error:", e, "Network state:", video.networkState);
                video.style.display = "none"; // Hide broken video, show gradient
            });

            // Success handling
            video.addEventListener("loadeddata", function() {
                console.log("Video data loaded");
                videoLoaded = true;
                video.style.opacity = "1";
                attemptPlay();
            });

            video.addEventListener("canplay", function() {
                console.log("Video can play");
                attemptPlay();
            });

            // Try after short delay
            setTimeout(() => {
                if (video.readyState >= 2) {
                    console.log("Video ready after timeout");
                    attemptPlay();
                } else {
                    console.log("Video not ready, gradient fallback active");
                }
            }, 2000);

            // Try on user interaction as last resort
            function userInteractionPlay() {
                if (!playAttempted && video.readyState >= 2) {
                    console.log("User interaction play attempt");
                    attemptPlay();
                }
            }

            document.addEventListener("click", userInteractionPlay, { once: true });
            document.addEventListener("touchstart", userInteractionPlay, { once: true });
        })();
    </script>
{{ end }}
